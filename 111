<%@ page import="java.sql.*, javax.naming.*, javax.sql.DataSource, java.io.*" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SQL Server Query Page</title>
</head>
<body>
    <h2>SQL Server Query Executor</h2>

    <form method="post">
        <label for="jndi">JNDI Name:</label><br>
        <input type="text" id="jndi" name="jndi" value="jdbc/SQLServerDB"><br><br>

        <label for="query">SQL Query:</label><br>
        <input type="text" id="query" name="query"><br><br>

        <button type="submit">Submit</button>
    </form>

    <h3>Query Result:</h3>
    <%
        String jndi = request.getParameter("jndi");
        String query = request.getParameter("query");

        if (jndi != null && !jndi.trim().isEmpty() && query != null && !query.trim().isEmpty()) {
            out.println("<br>");
            try {
                Context initContext = new InitialContext();
                DataSource ds = (DataSource) initContext.lookup("java:comp/env/" + jndi);
                Connection conn = ds.getConnection();
                out.println("Baglandi!<br>");

                Statement stmt = conn.createStatement();
                ResultSet rs = stmt.executeQuery(query);

                ResultSetMetaData rsmd = rs.getMetaData();
                int columnsNumber = rsmd.getColumnCount();
                while (rs.next()) {
                    for (int i = 1; i <= columnsNumber; i++) {
                        if (i > 1) out.print(", ");
                        out.print(rs.getString(i));
                    }
                    out.println("<br>");
                }

                conn.close();
            } catch (Exception e) {
                StringWriter sw = new StringWriter();
                PrintWriter pw = new PrintWriter(sw);
                e.printStackTrace(pw);
                out.println(sw.toString());
            }
        } else {
            out.println("Query girin");
        }
    %>
</body>
</html>



























<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee 
         http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
         version="3.1">
    
    <display-name>SimpleJSPApp</display-name>
    
    <welcome-file-list>
        <welcome-file>index.jsp</welcome-file>
    </welcome-file-list>
    
    <resource-ref>
        <description>SQL Server Database Connection</description>
        <res-ref-name>jdbc/SQLServerDB</res-ref-name>
        <res-type>javax.sql.DataSource</res-type>
        <res-auth>Container</res-auth>
    </resource-ref>
</web-app>

