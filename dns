#!/bin/bash

INPUT_FILE="input.txt"
OUTPUT_FILE="resolved_ips.txt"
VSERVER_FILE="vservers_with_zero_ip.txt"

> "$OUTPUT_FILE"
> "$VSERVER_FILE"

declare -A processed_ips

while read -r line; do
    ip=$(echo "$line" | awk '{print $6}')

    if [[ "$ip" == "0.0.0.0" ]]; then
        continue
    fi

    if [[ -n "${processed_ips[$ip]}" ]]; then
        continue
    fi

    dns_names=$(nslookup "$ip" | awk '/name =/ {print $NF}' | sed 's/\.$//')

    if [ -n "$dns_names" ]; then
        dns_combined=$(echo "$dns_names" | paste -sd '/' -)
        echo "$ip - $dns_combined" >> "$OUTPUT_FILE"
    else
        echo "$ip - No DNS record" >> "$OUTPUT_FILE"
    fi

    processed_ips["$ip"]=1
done < "$INPUT_FILE"

grep "0.0.0.0" "$INPUT_FILE" | while read -r line; do
    vserver_name=$(echo "$line" | grep -oP "add lb vserver \Kappjava[^\s]+")

    if [[ -n "$vserver_name" ]]; then
        echo "$vserver_name" >> "$VSERVER_FILE"
    fi
done

echo "İşlem tamamlandı."
echo "Çıktı dosyası: $OUTPUT_FILE"
echo "0.0.0.0 IP'leri içeren vserver'lar: $VSERVER_FILE"
